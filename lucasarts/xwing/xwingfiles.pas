unit xwingfiles;

{$mode delphi}{$H+}

interface

uses
  Classes, SysUtils;

type

  TBrfHeader = packed record
    id    : word;
    units : word;
    cnt   : word;
  end;

  TBrfUnitHeader = packed record
    //data : array [0..11] of byte;
    x,y,z : single;
    //tp  : SmallInt;
  end;

  TBrfUnitName = packed record
    a1,a2,a3,a4: Word;
    name : array [0..63-12] of char;
    flag : Dword;
  end;

  TBrfFile = record
    header : TbrfHeader;

    unitHeader : array of TBrfUnitHeader;
    unitName   : array of TBrfUnitName;

  end;

procedure ReadBrf(s: TStream; var fl: TBrfFile);

implementation

// defect.brf
// Header starts at $c38
// 160 - 6 = 156 / 14   14*11 = 154  14 * 10 = 140

procedure ReadBrf(s: TStream; var fl: TBrfFile);
begin
  s.Read(fl.header, sizeof(fl.header));

  SetLength(fl.unitHeader, fl.header.units);
  writeln('TBrfUnitHeader=',sizeof(TBrfUnitHeader),' ',sizeof(TBrfUnitName));
  s.Read(fl.unitHeader[0], fl.header.units * sizeof(TBrfUnitHeader));
  SetLength(fl.unitName, fl.header.units);
  s.Read(fl.unitName[0], fl.header.units * sizeof(TBrfUnitName));
end;

{

C:\games\xwing_rdr\HELLO.BRF
0000000000: 02 00 07 00 02 00

 B0 FF 30 01 80 00 AF 00 0F 00 F0 FF
 70 00 42 00 F0 FF 1C 00 70 00 E0 FF
 B8 07 68 F6 00 00 1A 00 73 00 00 00
 05 00 FC FF 04 00 98 FE 68 FF 00 00
 28 01 E0 FF 00 00 C0 00 78 00 00 00
 48 00 20 00 00 00 5F 05 58 00 00 00
 F8 FE E0 FC 00 00 40 00 E8 FE 04 00

            02 00 00 00 02 00 00 00
            52 45 44 00 00 00 00 00 00 00 00 00 00 00                     RED
0000000070: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0000000080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0000000090: 00 00 00 00 00 00 40 00 00 00

            06 00 00 00 03 00 02 00
            41 4C 50 48 41 00 │ 00 00 00 00 00 00 00 00             ALPHA
00000000B0: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
00000000C0: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
00000000D0: 00 00 00 00 00 00 40 00 │ 00 00 06 00 00 00 03 00        @   ♠   ♥
00000000E0: 02 00 42 45 54 41 00 00 │ 00 00 00 00 00 00 00 00  ☻ BETA
00000000F0: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
0000000100: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
0000000110: 00 00 00 00 00 00 40 00 │ 00 00 06 00 00 00 03 00        @   ♠   ♥
0000000120: 02 00 47 41 4D 4D 41 00 │ 00 00 00 00 00 00 00 00  ☻ GAMMA
0000000130: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
0000000140: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
0000000150: 00 00 00 00 00 00 40 00 │ 00 00 0F 00 00 00 01 00        @   ☼   ☺
0000000160: 00 00 4B 41 52 49 4E 4E │ 45 00 31 00 00 00 00 00    KARINNE 1
0000000170: 00 00 44 65 6C 65 67 61 │ 74 69 6F 6E 00 00 00 00    Delegation
0000000180: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
0000000190: 00 00 01 00 00 00 40 00 │ 00 00 10 00 00 00 01 00    ☺   @   ►   ☺
00000001A0: 00 00 41 56 45 4E 47 45 │ 52 00 45 41 44 00 00 00    AVENGER EAD
00000001B0: 00 00 00 65 6C 65 67 61 │ 74 69 6F 6E 00 00 00 00     elegation
00000001C0: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
00000001D0: 00 00 01 00 00 00 40 00 │ 00 00 28 00 00 00 01 00    ☺   @   (   ☺
00000001E0: 00 00 00 61 72 69 6E 6E │ 65 20 31 00 00 00 00 00     arinne 1
00000001F0: 00 00 00 65 6C 65 67 61 │ 74 69 6F 6E 00 00 00 00     elegation
0000000200: 00 00 00 00 00 00 00 00 │ 00 00 00 00 00 00 00 00
0000000210: 00 00 00 00 00 00 40 00 │ 00 00 02 00 00 00 00 00        @   ☻
0000000220: 0C 00 D4 00 01 00 73 00 │ 00 00 8A 00 D4 00 01 00  ♀ װ ☺ s    װ ☺





 02 00
 05 00
 02 00

 7A FD 6F 18 50 00 74 FE 75 18 10 00  x12
 86 FF 75 18 08 00 4E 00 77 18 08 00
 E0 FF 19 24 08 00 2D FF CB 1A 50 00
 00 FF CA 18 10 00 00 FF 2C 1A 08 00
 D1 08 2F 14 08 00 E0 FF C0 27 08 00





 02 00 00 00 02 00 00 00
 52 45 44 00 00 00 00 00 00 00 00 00 00 00                     RED
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 40 00 00 00








 01 00 00 00 01 00 00 00                                 8
 52 65 64 00 00 00 00 00 00 00 00 00 00 00               14
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00         16
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00         16
 00 00 00 00 00 00 40 00 00 00                           10 = 64

 17 00 01 00 01 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 40 00 00 00

 17 00 01 00 01 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 40 00 00 00

 04 00 00 00 03 00 00 00
 41 6C 70 68 61 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 40 00 00 00

 11 00 00 00 03 00 00 00
 4F 6D 65 67 61 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 40 00 00 00
--- HELLO

02 00 00 00 00 00
0C 00 D4 00 01 00 73 00 00 00 8A 00
D4 00 01 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00
0C 00 00 00 73 00

D4 00 01 00 00 00 00 00 0C 00
D4 00 01 00

0C 00 00 00 8A 00
D4 00 01 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00

0C 00 00 00
18 00 D4 00 00 00 04 00
19 01 6A 00 01 00 00 00
00 00 0B 00 01 00 00 00

0C 00 02 00 00 00 0F 00
D0 02 00 00 00 00 10 00
20 00 20 00 00 00 1E 00
02 00 80 00 D8 FE 08 00 16 00 04 00 10 00 1B 00
03 00 A8 04 A8 00 18 00 17 00 03 00 1C 00 18 00
01 00 20 00 19 00 02 00 20 00 1C 00 01 00 28 01
40 00 50 00 0A 00 50 00 0B 00 01 00 50 00 0C 00
03 00 50 00 0F 00 80 00 00 00 50 00 15 00 50 00
1A 00 58 00 16 00 00 00 60 00 1B 00 00 00 C0 FD
B8 FF 98 00 0A 00 98 00 0B 00 01 00 98 00 0C 00
04 00 98 00 15 00 98 00 1A 00 D0 00 0A 00 D0 00
0B 00 01 00 D0 00

0C 00 05 00 D0 00 0F 00 D0 02
00 00 D3 00 1B 00 04 00 30 FE 20 FD FA 00 01 00
FA 00 0A 00 FA 00 0B 00 01 00 FA 00

0C 00 05 00
0F 27 29 00 01 00 08 00 01 00 01 00 00 00 0B 00
01 00 00 00

0C 00 06 00 0F 27 29 00 01 00 08 00
01 00 01 00 00 00 0B 00 01 00 00 00

0C 00 07 00
0F 27 29 00 01 00 08 00 01 00 01 00 00 00 0B 00
01 00 00 00

0C 00 08 00 0F 27 29 00 09 00 00 00
00 00 00 00

--- DSTAR3
C:\games\xwing_rdr\DSTAR3.BRF
02 00 00 00 00 00

0C 00 D4 00 01 00 72 00 00 00 8A 00
D4 00 01 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00

0C 00 00 00 72 00
D4 00 01 00 00 00 00 00 0C 00
D4 00 01 00 0C 00 00 00 8A 00
D4 00 01 00 00 00 00 00 00 00

00 00
00 00 00 00 00 00 00 00 00 00 00 00

0C 00 00 00
72 00 D4 00 00 00 04 00 F6 00 67 00 01 00 00 00
00 00 0B 00 01 00 00 00

0C 00 02 00 00 00 0F 00
60 FE D9 19 00 00 10 00 20 00 20 00 08 00 16 00
00 00 10 00 1B 00 00 00 0C FD B5 1A 18 00 17 00
02 00 1C 00 18 00 01 00 20 00 1C 00 01 00 67 FE
62 19 50 00 0A 00 50 00 0B 00 01 00 50 00 0C 00
03 00 50 00 0F 00 60 FE 29 19 50 00 10 00 18 00
18 00 50 00 15 00 50 00 1A 00 58 00 1B 00 02 00
C3 FF AC 17 60 00 1C 00 02 00 B9 FB AC 17 80 00
0A 00 80 00 0B 00 01 00 80 00

0C 00 05 00 82 00
0F 00 50 FB 33 19 91 00 1E 00 03 00 06 F8 9B 17
98 00 1D 00 06 00 C6 F8 DE 17 B8 00 0A 00 B8 00
0B 00 01 00 B8 00

0C 00 04 00 C0 00 0F 00 20 FF
D9 19 C0 00 10 00 20 00 20 00 0F 27 29 00 01 00
10 00 01 00 01 00 00 00 0B 00 01 00 00 00 0C 00
06 00 00 00 0F 00
4A FF BA 17 00 00 10 00 23 00 23 00 0F 27 29 00 01 00 13 00 01 00 01 00
00 00 0B 00 01 00 00 00

0C 00 07 00 00 00 0E 00 07 00 00 00 0F 00
4A FF BA 17 00 00 10 00 23 00 23 00 0F 27 29 00 01 00 10 00 01 00 01 00
00 00 0B 00 01 00 00 00

0C 00 08 00 00 00 0F 00
4A FF BA 17 00 00 10 00 23 00 23 00 0F 27 29 00 00 00 05 00 00 00 01 00

}
end.



